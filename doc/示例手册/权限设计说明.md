# RBAC
> Role-Based Access Control
> 一种基于角色的权限访问控制。原则上所有的功能权限以及菜单权限都是基于角色来授权，避免直接给予用户授权。

### RBAC的优点
> 简化了用户和权限的关系，实现用户和资源的分离，后期分配和回收权限都会很方便。


### RBAC支持的安全原则
> RBAC支持三个著名的安全原则：最小权限原则、责任分离原则、数据抽象原则

* 最小权限原则：RBAC可以将角色配置成其完成任务所需的最小权限集合
* 责任分离原则：可以通过调用相互独立互斥的角色来共同完成敏感的任务，例如要求一个计账员和财务管理员共同参与统一过账操作
* 数据抽象原则：可以通过权限的抽象来体现，例如财务操作用借款、存款等抽象权限，而不是使用典型的读、写、执行权限

#### RBAC模块功能
> 用户管理
* 用户列表、添加用户、编辑用户、设置角色
> 角色管理
* 角色列表、添加角色、编辑角色、设置权限
> 权限管理
* 权限列表、添加权限、编辑权限

#### RBAC数据库表设计
* ins_user 用户表
* ins_user_role 用户角色关联
* ins_role 角色表
* ins_func_role 角色权限关联
* sys_func 权限表（type：'0' 菜单权限，'M' 操作权限）
* sys_menu 菜单表       
* ins_menu_role 角色菜单关联 (废弃)
```sql
                               ins_user 
                                  |
                            ins_user_role
                                  |
sys_func  -  ins_func_role  -  ins_role  -  ins_menu_role  -  sys_menu
```

```sql
ins_user  <->  ins_user_role  <->  ins_role  <->  ins_func_role  <->  sys_func
```



#### 临时权限如何分配
> 预先针对每个权限创建一个临时角色，并做好 ins_func_role 的关联，此项由系统自身保证。
> 临时赋权时，只需把某个临时角色赋予某个用户，即处理 ins_user_role 表，设置好临时权限的有效期。有效期为: 一天、一周、一月。
> 后台配置定时任务，定时将临时权限进行清除，移入临时权限历史表，确保权限数据的干净。

#### 登录步骤说明
* 根据 username 查 ins_user 表，获取用户的基本信息。
* 根据 user_id 查 ins_user_role 表, 获取用户有哪些角色。
* 根据 role_id 查 ins_func_role 表, 获取用户有哪些功能权限。
* 根据 role_id 查 ins_menu_role 表，获取用户有哪些菜单权限。

#### 获取登录上下文:
```java
UserContext userContext = WebContextUtils.getUserContext();
userContext.getMobileNo(); // 手机号码
userContext.getUsername(); // 用户名
userContext.getUserId();   // 用户ID
userContext.getRoles();    // 用户角色
Collection<GrantedAuthority> grantedAuthorities = userContext.getGrantedAuthorities();
grantedAuthorities.forEach(System.out::println); // 获取功能权限
```



#### 菜单授权:
* 只需对叶子菜单进去授权，系统会将叶子菜单的所有上级目录展示出来。
* 菜单授权基于角色表来进行。

