## 业务场景梳理:
```
当做一件事情，会发一个消息给 XXX (具体的某个人)。比如：部门调动里触发合同重签的消息给人资，个人。 
由后台任务驱动，比如合同快到期了，发送合同续签提醒，也是发送给具体的人。
```

## 消息分为三类

### 一、公告（announce）
sys_notify.notify_type = 1
针对全部用户的消息推送，比如系统停机维护。

##### 公告的功能实现
```
【新增公告】
    在 sys_notify 表中插一条公告数据（notify_type = 1）记录。
    
【分发公告】
    用户登录时，在自己的消息队列表中获取最近一条消息的时间戳。
    再根据时间戳查看是否有最新的公告数据，如果有插入个人消息队列表。

【查看公告】
    更新个人消息队列表中公告的已读标记。
```

### 二、提醒（remind）
sys_notify.notify_type = 2
特定环境下的通知，比如预算申请通知、合同审批通知、员工调动申请通知等。

##### 提醒的功能实现
```
【新增订阅】
    在 sys_subscribe 表中新增订阅数据。
    {
      "target_id" : 目标Id（对应实体表中的Id字段）
      "target_type" : 目标类型（预算、合同、计划、方案、报销...）
      "action" : 订阅目标变化类型（申请、审批、拒绝，关注...）
      "user_id" : 用户Id
      "create_time" : 创建时间
    }
    
【新增提醒】
    在 sys_notify 表中插一条提醒数据（notify_type = 2）记录，也即一个事件。
    {
      "content" : "", // 提醒是没有内容的
      "notify_type" : 2, // 提醒
      "target_id" : 同【订阅】,
      "target_type" : 同【订阅】,
      "action" : 同【订阅】,
      "sender_id" : 谁触发的该事件,
      "create_time" : 什么时候触发的事件
    }
    
【分发提醒】
    用户登录时，在自己的消息队列表中获取最近一条消息的时间戳。
    再根据时间戳查看是否有最新的提醒数据，如果有插入个人消息队列表。
    
【查看提醒】
    更新个人消息队列表中提醒的已读标记。
```

#### 具体提醒类消息样本
* 董明珠 审批了你的预算 《XXX一期工程的预算》
* 李寒穷 拒绝了你的报销 《差旅费报销-NO:HYCS201911251234》
* 李一男 关注了你的方案 《关于XXX一期工程的土建设计方案》

### 三、私信（message）
sys_notify.notify_type = 3
就是私有信息。

##### 私信的功能实现
```
【新增私信】
    在 sys_notify 表中插一条私信数据记录。
    {
      "content": "私信内容",
      "notify_type": 3,
      "target_id": 用户Id,
      "create_time": 时间戳
    }
    
【分发私信】
    用户登录时，在自己的消息队列表中获取最近一条消息的时间戳。
    再根据时间戳查看是否有发送给自己的私信，如果有插入个人消息队列表。

【查看私信】
    更新个人消息队列表中私信的已读标记。
```